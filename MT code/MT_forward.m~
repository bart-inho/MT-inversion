% Magnetotelluric (MT) forward model


%% N-layered half-space

clear

% Parameters
load freq.mat;
freq = freq'; % [Hz] frequency of signal
T = 1./freq; % [s] period of signal
omega = 2*pi*freq; % [Hz] angular frequency of signal
z = [0 200 400 1000]'; % [m] depths
sigma = [1e-3 1e-1 1e-2 1e-5]'; % [S/m] electrical conductivites
fs = 13; % Fontsize

% Variables
mu_0 = 4*pi*1e-7; % [H/m] magnetic permeability of free space

[C] = Wait_recursion(omega,z,sigma,mu_0); % C-response [m]
rho_a = (real(C).^2+imag(C).^2)*mu_0.*omega; % Apparent resistivity [Ohm.m]
phi = atand(imag(C)/real(C)) + 90; % Impedance phase [deg]

% Regrouping data
% data = [freq';rho_a';phi'];

figure(1),clf
loglog(T,rho_a,'-o')
% plot(T, rho_a, '-o')
grid on
xlabel('Period T [s]','FontSize',fs)
ylabel('Apparent resistivity \rho_a [\Omega\cdotm]','FontSize',fs)
title('MT forward model with synthetic datas','FontSize',fs)



%% Homogeneous half-space

% Rows: relative to medium
        % ocean, croute, manteau ext, manteau int, noyau
% Columns: relative to frequence

clear

mu_0 = 4*pi*1e-7; % [H/m] magnetic permeability of free space

T = linspace(1,1e4*3600*24*365.25); % [s] period
omega = 2*pi./T; % [1/s] angular frequency
sigma = [3.2;1e-2;5e-3;5;5e5]; % [S/m] electrical conductivities
q = 1i*mu_0*sigma*omega;
skin = 1./(real(sqrt(q))); % [m] skin-depth


E1 = 1;
t = linspace(0,1e6,length(omega));

E_0 = fun(E1,omega,t,q,0);
E_skin = fun(E1,omega,t,q,skin);


figure(2),clf
plot(T,skin*1e-3,'-')
grid on
xlabel('Period T [s]','FontSize',fs)
ylabel('Skin depth [km]','FontSize',fs)
title('MT forward model with synthetic datas','FontSize',fs)
legend('ocean','crust','upper mantle','lower mantle','core','Location','SouthOutside')

function [E] = fun(E1,omega,t,q,z)
    E = E1*exp(1i*omega.*t-q.*z);
end